# Development Note

Author: matianfu@gingerologist.com

本文档不讨论第一版硬件；仅基于最新的硬件原理图和全柔板的硬件的开发过程撰写。



## Log

### Progress (as of this writing)

原开发板硬件固件调试大多完成，包括：

1. （固件）蓝牙通讯基础框架
2. （固件）程序的基础结构
3. （固件）NRF_LOG（串口，尝试过JLINK RTT，后取消；JLINK RTT效率很低，仅适合一个Task的情况）
4. （固件）USB_CDC通讯
5. （固件）多种传感器走USB_CDC时的通讯协议
6. （手机）APP完成了导航界面，程序基础UI框架，蓝牙连接部分；
7. （电脑）APP完成了除IMU之外的所有传感器的数据传输，实时绘图，数据存文件；



新产品板需要增加和优化功能：

1. （固件）支持GPIO开关机；
2. （固件）支持屏显；
3. （固件）走串口的NRF_LOG没有了，要么自己实现一个backend走USB，或者恢复JLink RTT，后者需要大面积合并当前task代码，需要尝试后才有设计决策；
4. （固件）等算法工程师提供血压算法代码合并到代码里；
5. （固件）全局内存使用优化；
6. （固件）支持蓝牙需要的Notificatoin Data，定义各种传感器数据；
7. （手机）支持通过蓝牙Notification获得各种传感器数据，在界面上绘制，其中心跳是图标，其它（可能）是单纯数字或者Gauge；
8. （电脑）尽可能可以支持之前的原始数据导出，但可能需要通过蓝牙配置；低优先级需求；



比较急迫的任务是：

1. 上电烧录（已经OK）；
2. 支持按键开机（正在做）；
3. 确定一个Debug的方式（马上做）；



### 2023-10-30

#### Set up and Debug

如果芯片完全没有烧录过固件，首次上电需要：

1. 供电，用USB通过电脑供电；
2. 连接Debug接口的3个PIN（swdio, swdclk, gnd）到nRF52 DK（这个板子是nRF52832的，不是nRF52840，但一样使用，Debug Out接口不完全一致，见Nordic官方说明）；
3. 需要Hold住Power键保证MCU供电；
4. 通过nRF Connect的Flash工具下载程序，记得第一次使用应在命令行里执行一次`nrfjprog -e`命令擦除内置的配置寄存器，否则诸如NFC，RESET PIN的设置会受影响，在工程里配置的编译选项不会生效；















